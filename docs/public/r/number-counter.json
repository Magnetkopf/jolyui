{
  "name": "number-counter",
  "type": "registry:ui",
  "dependencies": [
    "motion"
  ],
  "files": [
    {
      "path": "ui/number-counter.tsx",
      "content": "import { motion, useInView, useSpring, useTransform } from \"motion/react\";\nimport * as React from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ntype EasingType =\n  | \"linear\"\n  | \"easeOut\"\n  | \"easeIn\"\n  | \"easeInOut\"\n  | \"spring\"\n  | \"bounce\";\n\ninterface NumberCounterProps {\n  value: number;\n  from?: number;\n  duration?: number;\n  delay?: number;\n  decimals?: number;\n  separator?: string;\n  decimalSeparator?: string;\n  prefix?: string;\n  suffix?: string;\n  easing?: EasingType;\n  className?: string;\n  once?: boolean;\n  formatFn?: (value: number) => string;\n}\n\n// Easing functions for CSS-based animation\nconst easingFunctions: Record<EasingType, number[]> = {\n  linear: [0, 0, 1, 1],\n  easeOut: [0.16, 1, 0.3, 1],\n  easeIn: [0.7, 0, 0.84, 0],\n  easeInOut: [0.65, 0, 0.35, 1],\n  spring: [0.34, 1.56, 0.64, 1],\n  bounce: [0.68, -0.55, 0.27, 1.55],\n};\n\n// Format number with separators\nconst formatNumber = (\n  value: number,\n  decimals: number,\n  separator: string,\n  decimalSeparator: string,\n): string => {\n  const fixed = value.toFixed(decimals);\n  const [intPart, decPart] = fixed.split(\".\");\n\n  const formattedInt = (intPart || \"\").replace(\n    /\\B(?=(\\d{3})+(?!\\d))/g,\n    separator,\n  );\n\n  return decPart\n    ? `${formattedInt}${decimalSeparator}${decPart}`\n    : formattedInt;\n};\n\n// Animated digit component for rolling effect\nconst AnimatedDigit = ({\n  digit,\n  delay = 0,\n}: {\n  digit: string;\n  delay?: number;\n}) => {\n  const isNumber = /\\d/.test(digit);\n\n  if (!isNumber) {\n    return <span className=\"inline-block\">{digit}</span>;\n  }\n\n  const num = parseInt(digit, 10);\n\n  return (\n    <span className=\"relative inline-block h-[1em] w-[0.6em] overflow-hidden\">\n      <motion.span\n        className=\"absolute top-0 left-0 flex w-full flex-col items-center\"\n        initial={{ y: \"-100%\" }}\n        animate={{ y: `${-num * 10}%` }}\n        transition={{\n          duration: 0.5,\n          delay,\n          ease: [0.16, 1, 0.3, 1],\n        }}\n      >\n        {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9].map((n) => (\n          <span key={n} className=\"h-[1em] leading-none\">\n            {n}\n          </span>\n        ))}\n      </motion.span>\n    </span>\n  );\n};\n\n// Spring-based counter using useSpring\nconst SpringCounter = ({\n  value,\n  from = 0,\n  decimals = 0,\n  separator = \",\",\n  decimalSeparator = \".\",\n  prefix = \"\",\n  suffix = \"\",\n  className,\n  once = true,\n  formatFn,\n  duration = 2,\n  delay = 0,\n}: NumberCounterProps) => {\n  const ref = React.useRef(null);\n  const isInView = useInView(ref, { once });\n  const [displayValue, setDisplayValue] = React.useState(from);\n\n  const springValue = useSpring(from, {\n    stiffness: 100,\n    damping: 30,\n    duration: duration * 1000,\n  });\n\n  React.useEffect(() => {\n    if (isInView) {\n      const timer = setTimeout(() => {\n        springValue.set(value);\n      }, delay * 1000);\n      return () => clearTimeout(timer);\n    }\n  }, [isInView, value, springValue, delay]);\n\n  React.useEffect(() => {\n    const unsubscribe = springValue.on(\"change\", (latest) => {\n      setDisplayValue(latest);\n    });\n    return unsubscribe;\n  }, [springValue]);\n\n  const formatted = formatFn\n    ? formatFn(displayValue)\n    : formatNumber(displayValue, decimals, separator, decimalSeparator);\n\n  return (\n    <span ref={ref} className={className}>\n      {prefix}\n      {formatted}\n      {suffix}\n    </span>\n  );\n};\n\n// Main NumberCounter component\nconst NumberCounter = React.forwardRef<HTMLSpanElement, NumberCounterProps>(\n  (\n    {\n      value,\n      from = 0,\n      duration = 2,\n      delay = 0,\n      decimals = 0,\n      separator = \",\",\n      decimalSeparator = \".\",\n      prefix = \"\",\n      suffix = \"\",\n      easing = \"easeOut\",\n      className,\n      once = true,\n      formatFn,\n    },\n    ref,\n  ) => {\n    const containerRef = React.useRef<HTMLSpanElement>(null);\n    const isInView = useInView(containerRef, { once });\n    const [count, setCount] = React.useState(from);\n\n    React.useEffect(() => {\n      if (!isInView) return;\n\n      const startTime = Date.now() + delay * 1000;\n      const endTime = startTime + duration * 1000;\n\n      // Cubic bezier easing function\n      const bezier = easingFunctions[easing] || easingFunctions.linear;\n      const cubicBezier = (t: number): number => {\n        const [x1 = 0, y1 = 0, x2 = 1, y2 = 1] = bezier;\n        // Simplified cubic bezier approximation\n        const cx = 3 * x1;\n        const bx = 3 * (x2 - x1) - cx;\n        const ax = 1 - cx - bx;\n        const cy = 3 * y1;\n        const by = 3 * (y2 - y1) - cy;\n        const ay = 1 - cy - by;\n\n        const sampleCurveX = (t: number) => ((ax * t + bx) * t + cx) * t;\n        const sampleCurveY = (t: number) => ((ay * t + by) * t + cy) * t;\n\n        // Newton-Raphson iteration for finding t given x\n        let x = t;\n        for (let i = 0; i < 8; i++) {\n          const currentX = sampleCurveX(x) - t;\n          if (Math.abs(currentX) < 0.0001) break;\n          const dx = (3 * ax * x + 2 * bx) * x + cx;\n          if (Math.abs(dx) < 0.0001) break;\n          x -= currentX / dx;\n        }\n\n        return sampleCurveY(x);\n      };\n\n      let animationFrame: number;\n\n      const animate = () => {\n        const now = Date.now();\n\n        if (now < startTime) {\n          animationFrame = requestAnimationFrame(animate);\n          return;\n        }\n\n        if (now >= endTime) {\n          setCount(value);\n          return;\n        }\n\n        const elapsed = now - startTime;\n        const total = endTime - startTime;\n        const progress = elapsed / total;\n        const easedProgress = cubicBezier(progress);\n\n        const currentValue = from + (value - from) * easedProgress;\n        setCount(currentValue);\n\n        animationFrame = requestAnimationFrame(animate);\n      };\n\n      animationFrame = requestAnimationFrame(animate);\n\n      return () => cancelAnimationFrame(animationFrame);\n    }, [isInView, value, from, duration, delay, easing]);\n\n    const formatted = formatFn\n      ? formatFn(count)\n      : formatNumber(count, decimals, separator, decimalSeparator);\n\n    return (\n      <span ref={containerRef} className={cn(\"tabular-nums\", className)}>\n        {prefix}\n        <span ref={ref}>{formatted}</span>\n        {suffix}\n      </span>\n    );\n  },\n);\n\nNumberCounter.displayName = \"NumberCounter\";\n\n// Rolling digits counter\ninterface RollingCounterProps {\n  value: number;\n  className?: string;\n  prefix?: string;\n  suffix?: string;\n  separator?: string;\n}\n\nconst RollingCounter = React.forwardRef<HTMLSpanElement, RollingCounterProps>(\n  ({ value, className, prefix = \"\", suffix = \"\", separator = \",\" }, ref) => {\n    const containerRef = React.useRef<HTMLSpanElement>(null);\n    const isInView = useInView(containerRef, { once: true });\n\n    const formattedValue = formatNumber(value, 0, separator, \".\");\n    const digits = formattedValue.split(\"\");\n\n    return (\n      <span\n        ref={containerRef}\n        className={cn(\"inline-flex tabular-nums\", className)}\n      >\n        {prefix && <span>{prefix}</span>}\n        <span ref={ref} className=\"inline-flex\">\n          {isInView &&\n            digits.map((digit, index) => (\n              <AnimatedDigit\n                key={`${index}-${digit}`}\n                digit={digit}\n                delay={index * 0.05}\n              />\n            ))}\n        </span>\n        {suffix && <span>{suffix}</span>}\n      </span>\n    );\n  },\n);\n\nRollingCounter.displayName = \"RollingCounter\";\n\n// Percentage counter with circular progress\ninterface CircularCounterProps {\n  value: number;\n  size?: number;\n  strokeWidth?: number;\n  className?: string;\n  duration?: number;\n  color?: string;\n  trackColor?: string;\n}\n\nconst CircularCounter = React.forwardRef<HTMLDivElement, CircularCounterProps>(\n  (\n    {\n      value,\n      size = 120,\n      strokeWidth = 8,\n      className,\n      duration = 2,\n      color = \"hsl(var(--primary))\",\n      trackColor = \"hsl(var(--muted))\",\n    },\n    ref,\n  ) => {\n    const containerRef = React.useRef<HTMLDivElement>(null);\n    const isInView = useInView(containerRef, { once: true });\n\n    const springValue = useSpring(0, {\n      duration: duration * 1000,\n      bounce: 0,\n    });\n\n    const radius = (size - strokeWidth) / 2;\n    const circumference = radius * 2 * Math.PI;\n\n    const offset = useTransform(springValue, [0, 100], [circumference, 0]);\n    const rounded = useTransform(springValue, (latest) => Math.round(latest));\n\n    React.useEffect(() => {\n      if (isInView) {\n        springValue.set(value);\n      }\n    }, [isInView, value, springValue]);\n\n    return (\n      <div\n        ref={containerRef}\n        className={cn(\n          \"relative inline-flex items-center justify-center\",\n          className,\n        )}\n        style={{ width: size, height: size }}\n      >\n        <svg width={size} height={size} className=\"-rotate-90\">\n          <circle\n            cx={size / 2}\n            cy={size / 2}\n            r={radius}\n            fill=\"none\"\n            stroke={trackColor}\n            strokeWidth={strokeWidth}\n          />\n          <motion.circle\n            cx={size / 2}\n            cy={size / 2}\n            r={radius}\n            fill=\"none\"\n            stroke={color}\n            strokeWidth={strokeWidth}\n            strokeLinecap=\"round\"\n            strokeDasharray={circumference}\n            style={{ strokeDashoffset: offset }}\n          />\n        </svg>\n        <div\n          ref={ref}\n          className=\"absolute inset-0 flex items-center justify-center\"\n        >\n          <span\n            className=\"font-bold tabular-nums leading-none\"\n            style={{ fontSize: size * 0.22 }}\n          >\n            <motion.span>{rounded}</motion.span>%\n          </span>\n        </div>\n      </div>\n    );\n  },\n);\n\nCircularCounter.displayName = \"CircularCounter\";\n\n// Compact counter for stats\ninterface StatCounterProps {\n  value: number;\n  label: string;\n  prefix?: string;\n  suffix?: string;\n  decimals?: number;\n  className?: string;\n}\n\nconst StatCounter = React.forwardRef<HTMLDivElement, StatCounterProps>(\n  (\n    { value, label, prefix = \"\", suffix = \"\", decimals = 0, className },\n    ref,\n  ) => {\n    return (\n      <div ref={ref} className={cn(\"text-center\", className)}>\n        <NumberCounter\n          value={value}\n          prefix={prefix}\n          suffix={suffix}\n          decimals={decimals}\n          duration={2.5}\n          easing=\"easeOut\"\n          className=\"font-bold text-4xl text-foreground\"\n        />\n        <p className=\"mt-2 text-muted-foreground text-sm\">{label}</p>\n      </div>\n    );\n  },\n);\n\nStatCounter.displayName = \"StatCounter\";\n\nexport {\n  CircularCounter,\n  formatNumber,\n  NumberCounter,\n  RollingCounter,\n  SpringCounter,\n  StatCounter,\n};\nexport type {\n  CircularCounterProps,\n  EasingType,\n  NumberCounterProps,\n  RollingCounterProps,\n  StatCounterProps,\n};\n",
      "type": "registry:ui",
      "target": ""
    }
  ]
}